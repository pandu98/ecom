{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\prabh\\\\OneDrive\\\\desktop\\\\web develop\\\\lcodev\\\\projfrontend\\\\src\\\\core\\\\PaymentB.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport { cartEmpty } from \"./helper/carthelper\";\nimport { getmeToken, processPayment } from \"./helper/paymenthelper\";\nimport { createOrder } from \"./helper/orderhelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\nimport DropIn from \"braintree-web-drop-in-react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst PaymentB = ({\n  products,\n  reload = undefined,\n  setReload = f => f\n}) => {\n  _s();\n\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {}\n  });\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n\n  const getToken = (userId, token) => {\n    getmeToken(userId, token).then(info => {\n      console.log(info);\n\n      if (info.error) {\n        setInfo({ ...info,\n          error: info.error\n        });\n        signout(() => {\n          return /*#__PURE__*/_jsxDEV(Redirect, {\n            to: \"/\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 39,\n            columnNumber: 24\n          }, this);\n        });\n      } else {\n        const clientToken = info.clientToken;\n        setInfo({\n          clientToken\n        });\n      }\n    });\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n\n  const getAmount = () => {\n    let amount = 0;\n    products.map(p => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n\n  const onPurchase = () => {\n    setInfo({\n      loading: true\n    });\n    let nonce;\n    let getNonce = info.instance.requestPaymentMethod().then(data => {\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount()\n      };\n      processPayment(userId, token, paymentData).then(response => {\n        if (response.error) {\n          if (response.code == \"1\") {\n            console.log(\"payment failed\");\n            signout(() => {\n              return /*#__PURE__*/_jsxDEV(Redirect, {\n                to: \"/\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 77,\n                columnNumber: 32\n              }, this);\n            });\n          }\n        } else {\n          setInfo({ ...info,\n            success: response.success,\n            loading: false\n          });\n          console.log(\"payment success\");\n          let product_names = \"\";\n          products.forEach(function (item) {\n            product_names += item.name + \", \";\n          });\n          const orderData = {\n            products: product_names,\n            transaction_id: response.transaction.id,\n            amount: response.transaction.amount\n          };\n          createOrder(userId, token, orderData).then(response => {\n            if (response.error) {\n              if (response.code == \"1\") {\n                console.log(\"order failed\");\n              }\n\n              signout(() => {\n                return /*#__PURE__*/_jsxDEV(Redirect, {\n                  to: \"/\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 102,\n                  columnNumber: 34\n                }, this);\n              });\n            } else {\n              if (response.success == true) {\n                console.log(\"order placed\");\n              }\n            }\n          }).catch(error => {\n            setInfo({\n              loading: false,\n              success: false\n            });\n            console.log(\"order failed\", error);\n          });\n          cartEmpty(() => {\n            console.log(\"cart is emptyed out\");\n          });\n          setReload(!reload);\n        }\n      }).catch(e => console.log(e));\n    }).catch(e => console.log(\"Nonce\", e));\n  };\n\n  const showbtnDropIn = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: info.clientToken !== null && products.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(DropIn, {\n          options: {\n            authorization: info.clientToken\n          },\n          onInstance: instance => info.instance = instance\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-block btn-success\",\n          children: \"Buy now\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Please login fisrt or add something in cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 9\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"your bill is \", getAmount()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 9\n    }, this), showbtnDropIn()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 160,\n    columnNumber: 5\n  }, this);\n};\n\n_s(PaymentB, \"s45VOdB/jNgH4aYMZkzUNAsAoIg=\");\n\n_c = PaymentB;\nexport default PaymentB;\n\nvar _c;\n\n$RefreshReg$(_c, \"PaymentB\");","map":{"version":3,"sources":["C:/Users/prabh/OneDrive/desktop/web develop/lcodev/projfrontend/src/core/PaymentB.js"],"names":["React","useState","useEffect","Redirect","cartEmpty","getmeToken","processPayment","createOrder","isAuthenticated","signout","DropIn","PaymentB","products","reload","undefined","setReload","f","info","setInfo","loading","success","clientToken","error","instance","userId","user","id","token","getToken","then","console","log","getAmount","amount","map","p","parseInt","price","onPurchase","nonce","getNonce","requestPaymentMethod","data","paymentData","paymentMethodNonce","response","code","product_names","forEach","item","name","orderData","transaction_id","transaction","catch","e","showbtnDropIn","length","authorization"],"mappings":"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","sourcesContent":["import React,{useState,useEffect} from \"react\";\r\nimport {Redirect} from \"react-router-dom\";\r\nimport { cartEmpty } from \"./helper/carthelper\";\r\nimport {getmeToken ,processPayment} from \"./helper/paymenthelper\"\r\nimport {createOrder} from \"./helper/orderhelper\"\r\nimport { isAuthenticated ,signout} from \"../auth/helper\";\r\n\r\nimport DropIn from \"braintree-web-drop-in-react\"\r\n\r\nconst PaymentB=({\r\nproducts,\r\nreload=undefined,\r\nsetReload=(f)=>f,\r\n\r\n})=>{\r\n\r\n    const [info,setInfo]=useState({\r\n        loading:false,\r\n        success:false,\r\n        clientToken:null,\r\n        error:\"\",\r\n        instance:{},\r\n    });\r\n\r\nconst userId=isAuthenticated && isAuthenticated().user.id;\r\nconst token= isAuthenticated && isAuthenticated().token;\r\n\r\nconst getToken=(userId,token)=>{\r\n    getmeToken(userId,token)\r\n    .then((info)=>{\r\n        console.log(info)\r\n        \r\n        if(info.error){\r\n            setInfo({\r\n                ...info,\r\n                error:info.error\r\n            })\r\n            signout(()=>{\r\n                return <Redirect to=\"/\" />\r\n            })\r\n        }\r\n        else{\r\n            const clientToken=info.clientToken;\r\n            setInfo({clientToken});\r\n        }\r\n    })\r\n};\r\n\r\nuseEffect(()=>{\r\n    getToken(userId,token);\r\n},[]);\r\n\r\nconst getAmount=()=>{\r\n    let amount=0;\r\n    products.map((p)=>{\r\n        amount=amount+parseInt(p.price);\r\n    });\r\n    return amount;\r\n};\r\n\r\nconst onPurchase=()=>{\r\n    setInfo({loading:true})\r\n    let nonce;\r\n    let getNonce=info.instance.requestPaymentMethod()\r\n    .then(data=>{\r\n        nonce=data.nonce;\r\n        const paymentData={\r\n            paymentMethodNonce:nonce,\r\n            amount:getAmount()\r\n        };\r\n        processPayment(userId,token,paymentData)\r\n        .then(response =>{\r\n            if(response.error){\r\n                if(response.code==\"1\"){\r\n                    console.log(\"payment failed\")\r\n                    signout(()=>{\r\n                        return <Redirect to=\"/\"/>\r\n                    })\r\n                }\r\n            }\r\n            else{\r\n                setInfo({...info,\r\n                success:response.success,loading:false\r\n                })\r\n                console.log(\"payment success\")\r\n                let product_names=\"\"\r\n                products.forEach(function(item){\r\n                    product_names+=item.name+\", \"\r\n                });\r\n                const orderData={\r\n                    products:product_names,\r\n                    transaction_id:response.transaction.id,\r\n                    amount: response.transaction.amount\r\n                }\r\n                createOrder(userId,token,orderData)\r\n                .then(response=>{\r\n                    if(response.error){\r\n                        if(response.code==\"1\"){\r\n                            console.log(\"order failed\")\r\n                        }\r\n                      signout(()=>{\r\n                          return <Redirect to=\"/\"/>\r\n                      })\r\n                                        }\r\n\r\n                       else{\r\n                           if(response.success==true){\r\n                               console.log(\"order placed\")\r\n                           }\r\n                       }                 \r\n                })\r\n                .catch(error =>{\r\n                    setInfo({loading:false,success:false})\r\n                    console.log(\"order failed\",error)\r\n                })\r\n                cartEmpty(()=>{\r\n                    console.log(\"cart is emptyed out\")\r\n                })\r\n                setReload(!reload)\r\n            }\r\n        })\r\n        .catch(e =>console.log(e))\r\n    })\r\n    .catch(e=>console.log(\"Nonce\",e))\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst showbtnDropIn=()=>{\r\n    return(\r\n        <div>\r\n            {\r\n                info.clientToken !==null&& products.length >0?\r\n                (\r\n                    <div>\r\n                        <DropIn\r\n                        options={{authorization:info.clientToken}}\r\n                        onInstance={instance =>(info.instance=instance)}\r\n                        >\r\n                             </DropIn>\r\n                    <button className=\"btn btn-block btn-success\">Buy now</button>\r\n                       \r\n</div>\r\n                ):\r\n                (\r\n                    <h3>Please login fisrt or add something in cart</h3>\r\n                )\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nreturn(\r\n    <div>\r\n        <h3>your bill is {getAmount()} \r\n        </h3>\r\n        {showbtnDropIn()}\r\n    </div>\r\n\r\n)\r\n  \r\n\r\n\r\n};\r\nexport default PaymentB;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}